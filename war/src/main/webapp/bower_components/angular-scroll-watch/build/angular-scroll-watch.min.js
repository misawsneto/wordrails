/*! angular-scroll-watch
version: 0.6.1
build date: 2016-2-13
author: [object Object]
https://github.com/pc035860/angular-scroll-watch.git */
!function(t,e){"object"==typeof exports||"object"==typeof module&&module.exports?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["angular"],e):t.returnExports=e(t.angular)}(this,function(t){function e(e){var n=0;return t.forEach(e,function(){n++}),n}function n(t,e){var n=[];t:for(var i=0;i<t.length;i++){for(var s=t[i],o=0;o<e.length;o++)if(s==e[o])continue t;n.push(s)}return n}function i(e){if(t.isArray(e))return e;if(t.isString(e))return e.split(" ");if(t.isObject(e)){var n=[];return t.forEach(e,function(t,e){t&&(n=n.concat(e.split(" ")))}),n}return e}function s(e,n){if(t.isArray(e)){n=n||[];for(var i=0;i<e.length;i++)n[i]=e[i]}else if(t.isObject(e)){n=n||{};for(var s in e)!hasOwnProperty.call(e,s)||"$"===s.charAt(0)&&"$"===s.charAt(1)||(n[s]=e[s])}return n||e}var o="pc035860.scrollWatch",r="swStyle",c="swClass",a="swBroadcast",l="swStage",f="pc035860",u="scrollWatch.stages";return t.module(o,[]).factory("scrollWatchStageFactory",["$window","$document","$parse","$log","$rootScope","$animate",function(o,r,c,a,l,f){var u=function(t,e,n){var i;return function(){var s=this,r=arguments;o.clearTimeout(i),i=o.setTimeout(function(){i=null,n||t.apply(s,r)},e),n&&!i&&t.apply(s,r)}},h=function(){return o.requestAnimationFrame||o.webkitRequestAnimationFrame||o.mozRequestAnimationFrame||o.oRequestAnimationFrame||o.msRequestAnimationFrame||function(t){o.setTimeout(t,1e3/60)}}(),d=t.element(o),g=function(t,e){this.init(t,e)},p=g.prototype;return p.name=null,p.element=null,p.configs=null,p._configId=0,p._binded=!1,p.init=function(t,e){this.name=t,this.element=e||null,this.scrollHandler=this._digest.bind(this),this._digestDebounced=u(this._digest,50),this._digestDebounced()},p.setElement=function(t){this.element=t,null===this.configs||this._binded||this._bind(this.element),this._digestDebounced()},p.clearElement=function(){this._binded&&this._unbind(this.element),this.element=null},p.addConfig=function(e){if(t.forEach(["target","from","to"],function(n){if(t.isUndefined(e[n]))throw new Error("`"+n+"` should be provided")}),null===this.configs&&(this.configs={},null!==this.element&&this._bind(this.element)),this._configId++,e.styleExpr&&(e.styleGetter=c(e.styleExpr)),e.classExpr&&(e.classGetter=c(e.classExpr)),e.brdcstExpr){var n=e.scope.$eval(e.brdcstExpr);n.$rootScope?(e.brdcstScope=l,delete n.$rootScope):e.brdcstScope=e.scope,n.$emit?(e.brdcstIsEmit=!0,delete n.$emit):e.brdcstIsEmit=!1,e.brdcstList=[],t.forEach(n,function(n,i){var s={event:i};t.isString(n)?(s.condition=c(n),s.wasActive=null):s.always=!0,e.brdcstList.push(s)})}return this.configs[this._configId]=e,this._digestDebounced(),this._configId},p.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===e(this.configs)&&(this.configs=null,null!==this.element&&this._unbind(this.element)))},p.digest=function(t){this._digest(null,t)},p.destroy=function(){this.clearElement(),this.configs=null,this.scrollHandler=null,this._digestDebounced=null},p.couldDestroy=function(){return null===this.element&&null===this.configs},p._isDefault=function(){return this.element[0]===o},p._getElementMetrics=function(e){var n,i,s,o,r;return o=e[0],n=o.getBoundingClientRect(),s=this._scrollTop(),i={offsetTop:n.top+s},r=this._isDefault()?i.offsetTop:this._traverseStageTop(o),t.isDefined(r)&&null!==r&&(i.stageTop=r),i},p._traverseStageTop=function(t){var e,n,i=this.element[0],s=0,o=function(t,e){return e||(e={}),e.parentNode=t.offsetParent,e.offsetTop=t.offsetTop,e.hitStage=e.parentNode===i,e},r=0;e=t,n=o(e);do{if(e=e.parentNode||e,n.parentNode===e){if(s+=n.offsetTop,n.hitStage)return s;n=o(e,n)}else if(e===i)return s+n.offsetTop-i.offsetTop;if(++r>=10)break}while("BODY"!==e.tagName||t===e);return null},p._contentHeight=function(){if(this._isDefault()){var t=r[0].documentElement,e=r[0].body;return Math.max(e.scrollHeight,t.scrollHeight,e.offsetHeight,t.offsetHeight,t.clientHeight)}return this.element[0].scrollHeight},p._containerHeight=function(){if(this._isDefault()){var t=r[0].documentElement.clientHeight,e=o.innerHeight;return t>e?e:t}return this.element[0].offsetHeight},p._scrollTop=function(){return this._isDefault()?o.pageYOffset:this.element[0].scrollTop},p._digest=function(){function e(e){var n,i,s,c,a=this._containerHeight(),l=this._contentHeight(),f=l-a,u=this._scrollTop(),h=this;n=function(t){return f+t},i=function(t){return t-f},s=function(t){return t>0?i(t):n(t)},c=function(e){var s,c,a,l;s=e.from<0?n(e.from):e.from,c=e.to<0?n(e.to):e.to,s>u?(l=0,a={$positive:s,$negative:i(s)}):u>c?(l=1,a={$positive:c,$negative:i(c)}):u>=s&&c>=u&&(l=(u-s)/(c-s),a={$positive:u,$negative:i(u)}),a.$progress=l,a.$percentage=100*l,e._lastProgress&&e._lastProgress!==l?e._lastProgress>l?a.$direction=-1:e._lastProgress<l&&(a.$direction=1):a.$direction=0,a.$height=e.target[0].offsetHeight,t.forEach(h._getElementMetrics(e.target),function(t,e){a["$"+e]=t}),e.styleGetter&&o(a,e),e.classGetter&&r(a,e),e.brdcstList&&d(a,e),e._lastProgress=l},t.isUndefined(e)?t.forEach(this.configs,c):this.configs[e]&&c(this.configs[e])}var o,r,c,a,l,u,d,g;return o=function(t,e){e.target.css(e.styleGetter(e.scope,t))},c=function(t,e){var n=t.attr,i=l(t,e,1);n.$addClass(i)},a=function(t,e){var n=t.attr,i=l(t,e,-1);n.$removeClass(i)},l=function(e,n,i){var s=e.target,o=s.data("$classCounts")||{},r=[];return t.forEach(n,function(t){(i>0||o[t])&&(o[t]=(o[t]||0)+i,o[t]===+(i>0)&&r.push(t))}),s.data("$classCounts",o),r.join(" ")},u=function(t,e,i){var s=t.target,o=n(i,e),r=n(e,i);r=l(t,r,-1),o=l(t,o,1),0===o.length?f.removeClass(s,r):0===r.length?f.addClass(s,o):f.setClass(s,o,r),t.scope.$digest()},r=function(e,n){var o=n.classGetter(n.scope,e),r=n._oldClassVal,a=i(o||[]);if(r){if(!t.equals(o,r)){var l=i(r);u(n,l,a)}}else c(n,a);n._oldClassVal=s(o)},g=function(t,e){var n=t.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():t.$apply(e)},d=function(e,n){t.forEach(n.brdcstList,function(t){var i,s;s=n.brdcstIsEmit?"$emit":"$broadcast",t.always?n.brdcstScope[s](t.event,null,e):t.condition&&(i=t.condition(n.scope,e),(null===t.wasActive||i!==t.wasActive)&&g(n.brdcstScope,function(){n.brdcstScope[s](t.event,i,e)}),t.wasActive=i)})},function(n,i){if(!(null===this.element||this._digesting&&t.isUndefined(i))){var s=this;this._digesting=!0,h(function(){e.call(s,i),s._digesting=!1})}}}(),p._bind=function(t){this._binded=!0,this._isDefault()?d.on("scroll",this.scrollHandler).on("resize",this.scrollHandler):(d.on("resize",this.scrollHandler),t.on("scroll",this.scrollHandler))},p._unbind=function(t){this._binded=!1,this._isDefault()?d.off("scroll",this.scrollHandler).off("resize",this.scrollHandler):(d.off("resize",this.scrollHandler),t.off("scroll",this.scrollHandler))},function(t,e){return new g(t,e)}}]).service("scrollWatchService",["scrollWatchStageFactory","$window","$log","$cacheFactory",function(e,n,i,s){var o=e(f,t.element(n));this.stages=s(u),this.stages.put(f,o),this.addStage=function(t,n){var i=this.stages.get(t);return i?void i.setElement(n):(i=e(t,n),void this.stages.put(t,i))},this.removeStage=function(t){var e=this.stages.get(t);e&&(e.clearElement(),this._checkStageDestroy(e))},this.addConfig=function(t){var n=t.stage,i=this.stages.get(n);return i||(i=e(n),this.stages.put(n,i)),[n,i.addConfig(t)]},this.removeConfig=function(t){var e=t[1],n=this._getStage(t);n&&(n.removeConfig(e),this._checkStageDestroy(n))},this.digest=function(t){var e=t[1],n=this._getStage(t);n&&n.digest(e)},this._checkStageDestroy=function(t){t.couldDestroy()&&(t.destroy(),this.stages.remove(t.name))},this._getStage=function(t){var e=t[0];return this.stages.get(e)}}]).directive("scrollWatch",["scrollWatchService","$parse",function(e){return{restrict:"A",link:function(n,i,s){function o(o){o&&t.isObject(o)&&(o=t.copy(o),u&&(e.removeConfig(u),(h||t.noop)()),o.target=i,o.scope=n,o.stage=o.stage||f,s[r]&&(o.styleExpr=s[r]),s[c]&&(o.classExpr=s[c],o.attr=s),s[a]&&(o.brdcstExpr=s[a]),o.digestSync&&(h=n.$watch(l)),u=e.addConfig(o))}function l(){u&&e.digest(u)}var u,h;(s[r]||s[c]||s[a])&&(n.$watch(s.scrollWatch,o,!0),i.on("$destroy",function(){u&&e.removeConfig(u)}))}}}]).directive("swStage",["scrollWatchService",function(t){return{restrict:"A",link:function(e,n,i){var s;i.$observe(l,function(e){e&&(s&&t.removeStage(s),s=e,t.addStage(s,n))}),n.on("$destroy",function(){s&&t.removeStage(s)})}}}]),o});