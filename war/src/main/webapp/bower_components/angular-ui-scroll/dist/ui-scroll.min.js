/*!
 * angular-ui-scroll
 * https://github.com/angular-ui/ui-scroll.git
 * Version: 1.3.3 -- 2016-03-02T14:02:47.867Z
 * License: MIT
 */
!function(){"use strict";angular.module("ui.scroll",[]).directive("uiScrollViewport",function(){return{controller:["$scope","$element",function(a,b){return this.viewport=b,this}]}}).directive("uiScroll",["$log","$injector","$rootScope","$timeout","$q","$parse",function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;return o=a.debug||a.log,l=function(a,b){return b.after(a),[]},p=function(a){return a.element.remove(),a.scope.$destroy(),[]},b.has&&b.has("$animate")&&(g=b.get("$animate")),n=1===angular.version.major&&angular.version.minor<3,g?n?(m=function(a,b){var c;return c=e.defer(),g.enter(a,null,b,function(){return c.resolve()}),[c.promise]},q=function(a){var b;return b=e.defer(),g.leave(a.element,function(){return a.scope.$destroy(),b.resolve()}),[b.promise]}):(m=function(a,b){return[g.enter(a,null,b)]},q=function(a){return[g.leave(a.element).then(function(){return a.scope.$destroy()})]}):(m=l,q=p),i=function(a,b,c,d){var e,f;return e=Object.create(Array.prototype),f=function(a){return e.eof=!1,e.bof=!1,e.first=a,e.next=a,e.minIndex=Number.MAX_VALUE,e.maxIndex=Number.MIN_VALUE},e.size=d,e.append=function(a){var b,c,d,f;for(f=[],c=0,d=a.length;d>c;c++)b=a[c],++e.next,f.push(e.insert("append",b));return f},e.prepend=function(a){var b,c,d,f,g;for(f=a.reverse(),g=[],c=0,d=f.length;d>c;c++)b=f[c],--e.first,g.push(e.insert("prepend",b));return g},e.insert=function(d,f){var g,h;if(g=b.$new(),g[a]=f,h={scope:g,item:f},c(g,function(a){return h.element=a}),d%1===0)return h.op="insert",e.splice(d,0,h);switch(h.op=d,d){case"append":return e.push(h);case"prepend":return e.unshift(h)}},e.remove=function(a,b){var c,d,f,g;if(angular.isNumber(a)){for(c=d=f=a,g=b;g>=f?g>d:d>g;c=g>=f?++d:--d)p(e[c]);return e.splice(a,b-a)}return e.splice(e.indexOf(a),1),q(a)},e.setUpper=function(){return e.maxIndex=e.eof?e.next-1:Math.max(e.next-1,e.maxIndex)},e.setLower=function(){return e.minIndex=e.bof?e.minIndex=e.first:Math.min(e.first,e.minIndex)},e.syncDatasource=function(a){var b;return b=e.minIndex-Math.min(e.minIndex,a.minIndex||Number.MAX_VALUE),a.minIndex=e.minIndex-=b,a.maxIndex=e.maxIndex=Math.max(e.maxIndex,a.maxIndex||Number.MIN_VALUE),b},e.clear=function(){return e.remove(0,e.length),f(arguments.length?arguments[0]:1)},f(1),e},j=function(a){var b,c,d,e;if(e=a.localName,"dl"===e)throw new Error("ui-scroll directive does not support <"+e+"> as a repeating tag: "+a.outerHTML);switch("li"!==e&&"tr"!==e&&(e="div"),e){case"tr":d=angular.element("<table><tr><td><div></div></td></tr></table>"),b=d.find("div"),c=d.find("tr");break;default:c=angular.element("<"+e+"></"+e+">")}return c},k=function(a,b,c,d){var e,f,g,h,i,k;return i=c[0]&&c[0].viewport?c[0].viewport:angular.element(window),i.css({"overflow-y":"auto",display:"block"}),h=null,f=null,e=0,g=function(){return i.outerHeight()*Math.max(.1,+d.padding||.1)},i.createPaddingElements=function(a){return h=new j(a),f=new j(a),b.before(h),b.after(f)},i.bottomDataPos=function(){var a;return(null!=(a=i[0].scrollHeight)?a:i[0].document.documentElement.scrollHeight)-f.height()},i.topDataPos=function(){return h.height()},i.bottomVisiblePos=function(){return i.scrollTop()+i.outerHeight()},i.topVisiblePos=function(){return i.scrollTop()},i.insertElement=function(a,b){return l(a,b||h)},i.insertElementAnimated=function(a,b){return m(a,b||h)},i.shouldLoadBottom=function(){return!a.eof&&i.bottomDataPos()<i.bottomVisiblePos()+g()},k=i.offset()?function(){return i.offset()}:function(){return{top:0}},i.clipBottom=function(){var b,c,d,e,f;for(e=0,b=d=f=a.length-1;(0>=f?0>=d:d>=0)&&(c=a[b],c.element.offset().top-k().top>i.outerHeight()+g());b=0>=f?++d:--d)e++;return e>0?(a.eof=!1,a.remove(a.length-e,a.length),a.next-=e,i.adjustPadding()):void 0},i.shouldLoadTop=function(){return!a.bof&&i.topDataPos()>i.topVisiblePos()-g()},i.clipTop=function(){var b,c,d,e,f;for(e=0,f=0,c=0,d=a.length;d>c&&(b=a[c],b.element.offset().top-k().top+b.element.outerHeight(!0)<-1*g());c++)f+=b.element.outerHeight(!0),e++;return e>0?(h.height(h.height()+f),a.bof=!1,a.remove(0,e),a.first+=e):void 0},i.adjustPadding=function(){return a.length?(e=(a[a.length-1].element.offset().top+a[a.length-1].element.outerHeight(!0)-a[0].element.offset().top)/a.length,h.height((a.first-a.minIndex)*e),f.height((a.maxIndex-a.next+1)*e)):void 0},i.syncDatasource=function(b){var c;if(a.length)return c=a.syncDatasource(b)*e,h.height(h.height()+c),i.scrollTop(i.scrollTop()+c),i.adjustPadding()},i.adjustScrollTop=function(a){var b;return b=h.height()-a,b>=0?h.height(b):(h.height(0),i.scrollTop(i.scrollTop()-b))},i},h=function(a,b,d,e){var g,h,i,j,k,l;this.isLoading=!1,l=b.scope()||c,g=function(a,b){var c,e,f,g,h,i,j;if(angular.isArray(b)){for(i=d.indexOf(a)+1,j=b.reverse(),c=e=0,g=j.length;g>e;c=++e)h=j[c],h===a.item?(f=!0,i--):d.insert(i,h);if(!f)return a.op="remove"}},this.applyUpdates=function(a,b){var c,f,h,i,j,k;if(angular.isFunction(a))for(c=d.slice(0),f=h=0,i=c.length;i>h;f=++h)k=c[f],g(k,a(k.item,k.scope,k.element));else{if(a%1!==0)throw new Error("applyUpdates - "+a+" is not a valid index");0<=(j=a-d.first)&&j<d.length&&g(d[a-d.first],b)}return e()},this.append=function(a){return d.append(a),e()},this.prepend=function(a){return d.prepend(a),e()},i=a.topVisible?f(a.topVisible).assign:function(){},j=a.topVisibleElement?f(a.topVisibleElement).assign:function(){},k=a.topVisibleScope?f(a.topVisibleScope).assign:function(){},h=a.isLoading?f(a.isLoading).assign:function(){},this.loading=function(a){return this.isLoading=a,h(l,a)},this.calculateProperties=function(){var a,c,e,f,g,h,m,n,o;for(o=0,m=[],f=0,g=d.length;g>f;f++){if(a=d[f],e=a.element.offset().top,h=n!==e,n=e,h&&(c=a.element.outerHeight(!0)),!(h&&b.topDataPos()+o+c<=b.topVisiblePos())){h&&(this.topVisible=a.item,this.topVisibleElement=a.element,this.topVisibleScope=a.scope,i(l,a.item),j(l,a.element),k(l,a.scope));break}m.push(o+=c)}return m}},{require:["?^uiScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(a,g,j){var l,m,n,o;if(!(o=g.uiScroll.match(/^\s*(\w+)\s+in\s+([\w\.]+)\s*$/)))throw new Error("Expected uiScroll in form of '_item_ in _datasource_' but got '"+g.uiScroll+"'");return n=o[1],m=o[2],l=Math.max(3,+g.bufferSize||10),function(a,g,o,p,q){var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;if(q=q||j,w=f(m)(a),E=function(){return angular.isObject(w)&&angular.isFunction(w.get)},!E()&&(w=b.get(m),!E()))throw new Error(m+" is not a valid datasource");return K=0,G=[],v=new i(n,a,q,l),M=new k(v,g,p,o),r=new h(o,M,v,function(){return x(),t(K)}),o.adapter&&(s=f(o.adapter)(a),angular.isObject(s)||(f(o.adapter).assign(a,{}),s=f(o.adapter)(a)),angular.extend(s,r),r=s),q(a.$new(),function(b,c){return M.createPaddingElements(b[0]),c.$destroy(),a.$on("$destroy",function(){return b.remove()})}),x=function(){return K++,G=[]},I=function(){return x(),arguments.length?v.clear(arguments[0]):v.clear(),t(K)},r.reload=I,y=function(a,b){return r.isLoading||r.loading(!0),1===G.push(b)?A(a):void 0},F=function(a){return a.element.height()&&a.element[0].offsetParent},N=function(a){var b,c,d;if(F(a)){for(c=0,d=v.length;d>c;c++)b=v[c],angular.isFunction(b.unregisterVisibilityWatcher)&&(b.unregisterVisibilityWatcher(),delete b.unregisterVisibilityWatcher);return t()}},D=function(a,b){return M.insertElement(a.element,b),F(a)?!0:(a.unregisterVisibilityWatcher=a.scope.$watch(function(){return N(a)}),!1)},H=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(p=[],q=[],r=[],c=function(a){return a>0?v[a-1].element:void 0},d=g=0,k=v.length;k>g;d=++g)switch(s=v[d],s.op){case"prepend":q.unshift(s);break;case"append":i=D(s,c(d))||i,s.op="none";break;case"insert":p=p.concat(M.insertElementAnimated(s.element,c(d))),s.op="none";break;case"remove":r.push(s)}for(h=0,l=r.length;l>h;h++)s=r[h],p=p.concat(v.remove(s));if(q.length){for(b=0,j=0,m=q.length;m>j;j++)s=q[j],i=D(s)||i,s.op="none",b+=s.element.outerHeight(!0);M.adjustScrollTop(b)}for(d=o=0,n=v.length;n>o;d=++o)f=v[d],f.scope.$index=v.first+d;return p.length?e.all(p).then(function(){return M.adjustPadding(),t(a)}):(M.adjustPadding(),G.length||M.syncDatasource(w)),i},t=function(a){return d(function(){return H(a),M.shouldLoadBottom()?y(a,!0):M.shouldLoadTop()&&y(a,!1),G.length?void 0:r.calculateProperties()})},u=function(a){return d(function(){var b;return b=H(a),M.shouldLoadBottom()?b&&y(a,!0):M.shouldLoadTop()&&(b||G[0])&&y(a,!1),G.shift(),G.length?A(a):(r.loading(!1),r.calculateProperties())})},2===w.get.length?(B=function(a){return w.get({index:v.next,append:v.length?v[v.length-1].item:void 0,count:l},a)},C=function(a){return w.get({index:v.first-l,prepend:v.length?v[0].item:void 0,count:l},a)}):(B=function(a){return w.get(v.next,l,a)},C=function(a){return w.get(v.first-l,l,a)}),A=function(b){return G[0]?v.length&&!M.shouldLoadBottom()?u(b):B(function(c){return b&&b!==K||a.$$destroyed?void 0:(c.length<l&&(v.eof=!0),c.length>0&&(M.clipTop(),v.append(c)),v.setUpper(),u(b))}):v.length&&!M.shouldLoadTop()?u(b):C(function(c){return b&&b!==K||a.$$destroyed?void 0:(c.length<l&&(v.bof=!0),c.length>0&&(v.length&&M.clipBottom(),v.prepend(c)),v.setLower(),u(b))})},J=function(){return c.$$phase||r.isLoading?void 0:(t(),a.$apply())},O=function(a){var b,c;return b=M[0].scrollTop,c=M[0].scrollHeight-M[0].clientHeight,0===b&&!v.bof||b===c&&!v.eof?a.preventDefault():void 0},M.bind("resize",J),M.bind("scroll",J),M.bind("mousewheel",O),a.$watch(w.revision,function(){return I()}),a.$on("$destroy",function(){return v.clear(),M.unbind("resize",J),M.unbind("scroll",J),M.unbind("mousewheel",O)}),L=function(a){throw new Error(a+" event is no longer supported - use applyUpdates instead")},z=w.scope?w.scope.$new():a.$new(),z.$on("insert.item",function(){return L("insert")}),z.$on("update.items",function(){return L("update")}),z.$on("delete.items",function(){return L("delete")})}}}}])}();