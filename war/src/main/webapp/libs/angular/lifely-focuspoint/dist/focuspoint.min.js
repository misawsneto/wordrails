/**
 * @license Focuspoint v1.0.5
 * (c) 2015 Lifely
 * License: MIT
 */
!function(a){"use strict";var b={isDOMElement:function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},areDOMElements:function(a){try{if("object"!=typeof a||!Array.isArray(a))throw"arr is not an array.";return a.every(function(a){return b.isDOMElement(a)})}catch(d){return new c.InternalError("Helpers.areDOMElements()",d)}},bound:function(a,b,d){try{if("number"!=typeof a)throw"value is not a number.";if("number"!=typeof b)throw"min is not a number.";if("number"!=typeof d)throw"max is not a number.";return Math.max(b,Math.min(a,d))}catch(e){return new c.InternalError("Helpers.bound()",e)}},getPositionInElementByEvent:function(a,d,e,f,g){try{if(!b.isDOMElement(a))throw"elm is not a DOM element.";if("undefined"==typeof f)throw"event is undefined.";if(g){if("undefined"!=typeof f.touches&&f.touches.length<=0)throw"no touches found in event.";if("number"!=typeof f.touches[0].pageX)throw"event.touches[0].pageX not found.";if("number"!=typeof f.touches[0].pageY)throw"event.touches[0].pageY not found."}else{if("number"!=typeof f.pageX)throw"event.pageX not found.";if("number"!=typeof f.pageY)throw"event.pageY not found."}var h=a.getBoundingClientRect(),i=(g?f.touches[0].pageX:f.pageX)-e.x,j=(g?f.touches[0].pageY:f.pageY)-e.y,k=i/h.width,l=j/h.height,m=d.x+k,n=d.y+l,o=b.bound(m,0,1),p=b.bound(n,0,1);return{x:o,y:p}}catch(q){return new c.InternalError("Helpers.getPositionInElementByEvent()",q)}},setBackgroundPositionToElm:function(a,d,e){try{if(!b.isDOMElement(a))throw"elm is not a DOM element.";if("number"!=typeof d)throw"x is not a number.";if("number"!=typeof e)throw"y is not a number.";if(0>d||d>1)throw"x must be a number between 0 and 1.";if(0>e||e>1)throw"y must be a number between 0 and 1.";var f=b.bound(d,0,1),g=b.bound(e,0,1),h=100*f+"%",i=100*g+"%";return a.style.backgroundPosition="top "+i+" left "+h,!0}catch(j){return new c.InternalError("Helpers.setBackgroundPositionToElm()",j)}},setPositionToButtonElement:function(a,d,e){try{if(!b.isDOMElement(a))throw"elm is not a DOM element.";if("number"!=typeof d)throw"x is not a number.";if("number"!=typeof e)throw"y is not a number.";if(0>d||d>1)throw"x must be a number between 0 and 1.";if(0>e||e>1)throw"y must be a number between 0 and 1.";return a.style.left=100*d+"%",a.style.top=100*e+"%",!0}catch(f){return new c.InternalError("Helpers.setPositionToButtonElement()",f)}},initializeDrag:function(a,d,e,f,g,h){try{if(!b.isDOMElement(a))throw"container_elm is not a DOM element";if(!b.isDOMElement(d))throw"button_elm is not a DOM element";if("object"!=typeof e)throw"current coordinates placeholder is not an object";if("object"!=typeof f)throw"eventSystem is not an object";if("boolean"!=typeof g)throw"hide_cursor is not a boolean";if(g&&"string"!=typeof h)throw"no_cursor_class is not a string";var i,j={},k={},l=function(c,d){if("end"!==c){"start"===c&&(i?(j.x=d.touches[0].pageX,j.y=d.touches[0].pageY):(j.x=d.pageX,j.y=d.pageY),k.x=e.x,k.y=e.y);var l=b.getPositionInElementByEvent(a,k,j,d,i),m=l.x!==e.x||l.y!==e.y;m&&(e.x=l.x,e.y=l.y,f.applyEvent("change",[e.x,e.y]))}f.applyEvent("drag:"+c,[e.x,e.y]),g&&("start"===c?a.classList.add(h):"end"===c&&a.classList.remove(h))},m=function(a){a.preventDefault(),i="undefined"!=typeof a.touches,l("start",a),document.addEventListener(i?"touchmove":"mousemove",n),document.addEventListener(i?"touchend":"mouseup",o)},n=function(a){a.preventDefault(),window.requestAnimationFrame(function(){l("move",a)})},o=function(a){a.preventDefault(),l("end",a),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",o),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};return d.addEventListener("touchstart",m),d.addEventListener("mousedown",m),function(){d.removeEventListener("touchstart",m),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",o),d.removeEventListener("mousedown",m),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)}}catch(p){return new c.InternalError("Helpers.initializeDrag()",p)}},attachViews:function(a,d,e){try{if(Array.isArray(a)&&!b.areDOMElements(a))throw"view_elm is an array, but not all items are DOM elements";if(!(Array.isArray(a)||"object"==typeof a&&b.isDOMElement(a)))throw"view_elm is not a DOM element";if("object"!=typeof d)throw"current is not an object";if("number"!=typeof d.x)throw"current.x is not a number";if("number"!=typeof d.y)throw"current.y is not a number";if("function"!=typeof e)throw"event_binder is not a function";var f=function(a,c,d){if(Array.isArray(a))a.forEach(function(a){b.setBackgroundPositionToElm(a,c,d)});else{var e=a;b.setBackgroundPositionToElm(e,c,d)}};return f(a,d.x,d.y),e("change",function(b,c){f(a,b,c)})}catch(g){return new c.InternalError("Helpers.attachViews()",g)}},attachButton:function(a,d,e){try{if(!b.isDOMElement(a))throw"button_elm is not a DOM element";if("object"!=typeof d)throw"current is not an object";if("number"!=typeof d.x)throw"current.x is not a number";if("number"!=typeof d.y)throw"current.y is not a number";if("function"!=typeof e)throw"event_binder is not a function";return b.setPositionToButtonElement(a,d.x,d.y),e("change",function(c,d){b.setPositionToButtonElement(a,c,d)})}catch(f){return new c.InternalError("Helpers.attachButton()",f)}}},c={ApiError:function(a,b){return console.error("Focuspoint error in "+a+":",b),{error:!0,internal:!1,context:a,message:b}},InternalError:function(a,b){return console.error("Focuspoint internal error in "+a+":",b),{error:!0,internal:!0,context:a,message:b}},Current:function(a,b){try{if("number"!=typeof a)throw"x is not a number.";if("number"!=typeof b)throw"y is not a number.";if(0>a||a>1)throw"x must be a number between 0 and 1.";if(0>b||b>1)throw"y must be a number between 0 and 1.";return{x:a,y:b}}catch(d){return new c.InternalError("Library.Current()",d)}},EventSystem:function(){var a=this;a.possibleEvents=["drag:start","drag:move","drag:end","change"],a.increment=0,a.callbacks=[],a.applyEvent=function(b,d){try{if(-1===a.possibleEvents.indexOf(b))throw'Event "'+b+'" not found.';if(d=d||[],!Array.isArray(d))throw"Arguments is not an array.";a.callbacks.forEach(function(a,c){if(a.event===b){if("function"!=typeof a.handler)throw"Callback is not a function.";a.handler.apply(window,d)}})}catch(e){return new c.InternalError("Library.EventSystem().applyEvent()",e)}},a.register=function(b,d){try{if("string"!=typeof b)throw"event is not a string";if(-1===a.possibleEvents.indexOf(b))throw'event "'+b+'" does not exist';if("function"!=typeof d)throw"handler is not a function";a.increment++;var e=a.increment,f={id:e,event:b,handler:d};return a.callbacks.push(f),e}catch(g){return new c.InternalError("Library.EventSystem().register()",g)}},a.unregister=function(b){try{if("number"!=typeof b)throw"id should be a number.";var d=null;if(a.callbacks.forEach(function(a,c){d||a.id===b&&(d=c)}),null===d)throw"Could not find listener for id: "+b;return!!a.callbacks.splice(d,1)}catch(e){return new c.InternalError("Library.EventSystem().unregister()",e)}},a.unregisterAll=function(){a.callbacks=[]}},ViewOptions:function(a,c,d){try{if(c=c||{},!b.isDOMElement(a))throw"elm is not a DOM element.";if("object"!=typeof c||Array.isArray(c))throw"options exists, but is not an object.";if("number"!=typeof c.x&&c.x)throw'"options.x" exists, but is not a number.';if("number"!=typeof c.y&&c.y)throw'"options.y" exists, but is not a number.';if("number"==typeof c.x&&(c.x<0||c.x>1))throw'"options.x" must be a number between 0 and 1.';if("number"==typeof c.y&&(c.y<0||c.y>1))throw'"options.y" must be a number between 0 and 1.';return"number"!=typeof c.x&&(c.x=.5),"number"!=typeof c.y&&(c.y=.5),{elm:a,x:c.x,y:c.y}}catch(e){d(e)}},EditOptions:function(a,c,d){try{if(c=c||{},!b.isDOMElement(a))throw"element is not a DOM element.";if("object"!=typeof c||Array.isArray(c))throw"options exists, but is not an object.";if("undefined"!=typeof c.x&&"number"!=typeof c.x)throw"options.x exists, but is not a number.";if("undefined"!=typeof c.y&&"number"!=typeof c.y)throw"options.y exists, but is not a number.";if("number"==typeof c.x&&(c.x<0||c.x>1))throw"options.x must be a number between 0 and 1.";if("number"==typeof c.y&&(c.y<0||c.y>1))throw"options.y must be a number between 0 and 1.";if("undefined"!=typeof c.view_elm&&Array.isArray(c.view_elm)&&!b.areDOMElements(c.view_elm))throw"options.view_elm is an array, but not all items are elements.";if(!("undefined"==typeof c.view_elm||Array.isArray(c.view_elm)||"object"==typeof c.view_elm&&b.isDOMElement(c.view_elm)))throw"options.view_elm is given, but is not a DOM element.";if("undefined"!=typeof c.button_elm&&!b.isDOMElement(c.button_elm))throw"options.button_elm is given, but is not a DOM element.";if("undefined"!=typeof c.hide_cursor&&"boolean"!=typeof c.hide_cursor)throw"options.hide_cursor exists, but is not a boolean.";if("undefined"!=typeof c.no_cursor_class&&"string"!=typeof c.no_cursor_class)throw"options.no_cursor_class exists, but is not a string.";if("number"!=typeof c.x&&(c.x=.5),"number"!=typeof c.y&&(c.y=.5),!c.button_elm){var e=a.querySelector(".lfy-focuspoint-button");if(!b.isDOMElement(e))throw'options.button_elm is not given, and could not find a button with class "lfy-focuspoint-button" as fallback';c.button_elm=e}return"boolean"!=typeof c.hide_cursor&&(c.hide_cursor=!0),"string"!=typeof c.no_cursor_class&&(c.no_cursor_class="lfy-focuspoint-edit-hidecursor"),{elm:a,view_elm:c.view_elm,button_elm:c.button_elm,hide_cursor:c.hide_cursor,no_cursor_class:c.no_cursor_class,x:c.x,y:c.y}}catch(f){d(f)}}};a.Focuspoint={View:function(a,d){var e=new c.ViewOptions(a,d,function(a){new c.ApiError("Focuspoint.View()",a)}),f=new c.Current(e.x,e.y),g=(b.setBackgroundPositionToElm(e.elm,f.x,f.y),!1),h=this;h.current=f,h.set=function(a,d){try{if(g)throw"this Focuspoint.View has been killed";if("number"!=typeof a)throw"the given x coordinate is not a number";if("number"!=typeof d)throw"the given y coordinate is not a number";if(0>a||a>1)throw"the x coordinate must be a number between 0 and 1";if(0>d||d>1)throw"the y coordinate must be a number between 0 and 1";var f=b.setBackgroundPositionToElm(e.elm,a,d);f.error||(h.current.x=a,h.current.y=d)}catch(i){return new c.ApiError("Focuspoint.View().set()",i)}},h.kill=function(){try{if(g)throw"this Focuspoint.View has already been killed";g=!0,delete h.current}catch(a){return new c.ApiError("Focuspoint.View().kill()",a)}}},Edit:function(a,d){var e=new c.EditOptions(a,d,function(a){new c.ApiError("Focuspoint.Edit()",a)}),f=new c.EventSystem,g=new c.Current(e.x,e.y),h=b.initializeDrag(e.elm,e.button_elm,g,f,e.hide_cursor,e.no_cursor_class);if(e.view_elm){b.attachViews(e.view_elm,g,f.register)}var i=(b.attachButton(e.button_elm,g,f.register),!1),j=this;j.current=g,j.set=function(a,d){try{if(i)throw"this Focuspoint.Edit has been killed";if("number"!=typeof a)throw"the given x coordinate is not a number";if("number"!=typeof d)throw"the given y coordinate is not a number";if(0>a||a>1)throw"the x coordinate must be a number between 0 and 1";if(0>d||d>1)throw"the y coordinate must be a number between 0 and 1";var g=b.setPositionToButtonElement(e.button_elm,a,d);g.error||(j.current.x=a,j.current.y=d),f.applyEvent("change",[j.current.x,j.current.y])}catch(h){return new c.ApiError("Focuspoint.Edit().set()",h)}},j.on=function(a,b){try{if(i)throw"this Focuspoint.Edit has been killed";if("string"!=typeof a)throw"event is not a string";if("function"!=typeof b)throw"handler is not a function";if(-1===f.possibleEvents.indexOf(a))throw'event "'+a+'" does not exist';f.register(a,b)}catch(d){return new c.ApiError("Focuspoint.Edit().on()",d)}},j.off=function(a){try{if(i)throw"this Focuspoint.Edit has been killed";if("number"!=typeof a)throw"id is not a number";f.unregister(a)}catch(b){return new c.ApiError("Focuspoint.Edit().off()",b)}},j.kill=function(){try{if(i)throw"this Focuspoint.Edit has already been killed";f.unregisterAll(),h(),i=!0,delete j.current}catch(a){return new c.ApiError("Focuspoint.Edit().kill()",a)}}}}}(window);
